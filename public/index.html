<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Dungeon Scoundrel - Roguelike Card Game</title>
    
    <!-- CRITICAL: Production-aware silent logging (must be first) -->
    <script>
    (function(){
        var p = location.hostname.includes('netlify.app') || location.hostname === 'dungeonscoundrel.com';
        window.silentLog = p ? function(){} : console.log.bind(console);
        window.silentWarn = p ? function(){} : console.warn.bind(console);
        window.silentError = p ? function(){} : console.error.bind(console);
        window.isProduction = p;
        // Override console methods in production to prevent any errors showing
        if (p) {
            window.onerror = function() { return true; };
            window.onunhandledrejection = function(e) { e.preventDefault(); };
        }
    })();
    </script>
    
    <!-- Critical preconnects (before any external resources) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    
    <!-- Preload LCP image for faster rendering -->
    <link rel="preload" as="image" href="assets/images/dungeon-bg.webp" fetchpriority="high">
    
    <!-- Preload critical font (Cinzel - most used) -->
    <link rel="preload" href="https://fonts.gstatic.com/s/cinzel/v23/8vIU7ww63mVu7gtR-kwKxNvkNOjw-tbnfY3lCA.woff2" as="font" type="font/woff2" crossorigin>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="A dark medieval roguelike card game. Explore dungeons, fight monsters, collect powerful relics and prove your skill in this challenging card game! 4 difficulties, 50 achievements, permanent unlock system.">
    <meta name="keywords" content="roguelike, card game, medieval, dungeon crawler, RPG, strategy, browser game, HTML5 game, dark fantasy, atmospheric">
    <meta name="author" content="Dungeon Scoundrel Team">
    <meta name="theme-color" content="#2c2416">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.dungeonscoundrel.com/">
    <meta property="og:title" content="Dungeon Scoundrel - Dark Medieval Roguelike Card Game">
    <meta property="og:description" content="A challenging medieval roguelike card game. Explore dungeons, collect relics, defeat monsters! 4 difficulties, 50 achievements. Play now in your browser!">
    <meta property="og:image" content="https://www.dungeonscoundrel.com/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Dungeon Scoundrel - Dark Medieval Roguelike Card Game">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Dungeon Scoundrel">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://www.dungeonscoundrel.com/">
    <meta name="twitter:title" content="Dungeon Scoundrel - Dark Medieval Roguelike">
    <meta name="twitter:description" content="A challenging medieval roguelike card game. Explore dungeons, collect relics, defeat monsters! Play now!">
    <meta name="twitter:image" content="https://www.dungeonscoundrel.com/og-image.png">
    <meta name="twitter:image:alt" content="Dungeon Scoundrel - Dark Medieval Roguelike Card Game">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.svg">
    <link rel="mask-icon" href="favicon.svg" color="#d4af37">
    <link rel="apple-touch-icon" href="favicon.svg">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="site.webmanifest">
    
    <!-- Critical CSS (inline for FCP) -->
    <style>
        /* Critical CSS - Above the fold styles */
        body{margin:0;background:#1a1510;color:#e8dcc4;font-family:'Cinzel',serif}
        .loading-screen{position:fixed;inset:0;background:#1a1510;display:flex;align-items:center;justify-content:center;z-index:9999}
        .loading-spinner{width:50px;height:50px;border:3px solid rgba(201,169,97,0.3);border-top-color:#c9a961;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
    </style>
    
    <!-- Fonts (with display=swap for better FCP) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Cinzel+Decorative:wght@700;900&family=MedievalSharp&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="src/styles/variables.css">
    <link rel="stylesheet" href="src/styles/styles.css">
    <link rel="stylesheet" href="src/styles/animations.css">
    <link rel="stylesheet" href="src/styles/scrollbar.css">
    <link rel="stylesheet" href="src/styles/components/waitlist.css">
    <link rel="stylesheet" href="src/styles/components/buttons.css">

</head>
<body>

    <!-- ============================================ -->
    <!-- MOBILE WAITLIST MODAL
    <!-- ============================================ -->
    <div id="mobileWaitlistModal">
        <div class="waitlist-container">
            <div class="waitlist-icon">üì±</div>
            <h1 class="waitlist-title">Coming Soon to Mobile!</h1>
            <p class="waitlist-subtitle">
                Dungeon Scoundrel is being optimized for mobile devices. 
                <strong>Play now on desktop</strong> for the best experience!
            </p>
            
            <div class="waitlist-form">
                <p style="color: #ffd700; margin-bottom: 20px; font-weight: 600;">
                    üéÆ Be the first to know when mobile version launches!
                </p>
                
                <input 
                    type="email" 
                    id="waitlistEmail" 
                    class="waitlist-input" 
                    placeholder="your.email@example.com"
                    autocomplete="email"
                >
                
                <div class="waitlist-checkbox-group">
                    <label class="waitlist-checkbox-label required">
                        <input type="checkbox" id="waitlistPrivacy" required>
                        <span>I accept the <a href="/privacy-policy.html" target="_blank" style="color: #ffd700;">Privacy Policy</a> and consent to the processing of my personal data in accordance with LGPD</span>
                    </label>
                    
                    <label class="waitlist-checkbox-label required">
                        <input type="checkbox" id="waitlistMarketing" required>
                        <span>I want to receive tips, news, and updates about Dungeon Scoundrel</span>
                    </label>
                </div>
                
                <div id="waitlistValidation" class="waitlist-validation"></div>
                
                <button class="waitlist-btn" onclick="joinWaitlist()">
                    ‚ú® Join Waitlist
                </button>
                
                <div id="waitlistSuccess" class="waitlist-success">
                    <strong>üéâ Success!</strong><br>
                    You're on the list! We'll notify you as soon as the mobile version is ready.
                </div>
            </div>
            
            <div class="waitlist-desktop-link">
                <p>Want to play now?</p>
                <p><a href="#" onclick="dismissMobileWarning()">Continue to desktop version ‚Üí</a></p>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- WELCOME SCREEN
    <!-- ============================================ -->
    <div class="welcome-screen" id="welcomeScreen" style="
        background: url('assets/images/dungeon-bg.webp') center center / cover no-repeat, linear-gradient(180deg, #1a1410 0%, #0d0a08 50%, #000000 100%);
        position: relative;
        overflow: hidden;
    ">
        <!-- Dark Overlay for Readability -->
        <div style="position: absolute; inset: 0; background: rgba(0, 0, 0, 0.65); pointer-events: none; z-index: 1;"></div>
        
        <!-- Vignette Effect -->
        <div style="position: absolute; inset: 0; background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.85) 100%); pointer-events: none; z-index: 2;"></div>
        
        <!-- Noise Texture Overlay -->
        <div style="position: absolute; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px); pointer-events: none; z-index: 3; opacity: 0.5;"></div>
        
        <!-- Content Container -->
        <div style="position: relative; z-index: 4; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px;">
        
        <!-- Title Logo Image -->
        <div style="text-align: center; margin-bottom: 12px;">
            <img src="assets/images/title-logo.webp" alt="Dungeon Scoundrel" 
                fetchpriority="high" decoding="async"
                style="
                max-width: min(85vw, 800px);
                height: auto;
                display: block;
                margin: 0 auto;
                filter: drop-shadow(0 0 18px rgba(201, 169, 97, 0.45))
                        drop-shadow(0 7px 25px rgba(0, 0, 0, 0.85));
                image-rendering: crisp-edges;
                -webkit-user-drag: none;
            " width="1310" height="165">
        </div>
        
        <!-- Subtitle -->
        <p style="
            font-family: 'Cinzel', serif;
            font-size: clamp(0.75em, 1.9vw, 0.95em);
            color: #8b7355;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            margin: 10px 0 30px 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
            font-weight: 600;
        ">A Roguelike Card Game</p>
        <!-- Menu Buttons Container -->
        <div style="display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 400px; margin-bottom: 20px;">
            <button id="btnWelcomeStart" aria-label="Start a new quest" role="button" style="
                font-family: 'Cinzel', serif;
                font-size: clamp(0.9em, 2.3vw, 1.05em);
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                padding: 14px 22px;
                background: linear-gradient(180deg, #ffd700 0%, #c9a961 100%);
                border: 2px solid #d4af37;
                box-shadow: 
                    0 0 0 1px #8b7355,
                    inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.5),
                    0 4px 12px rgba(0, 0, 0, 0.6);
                color: #1a1410;
                cursor: pointer;
                transition: all 0.2s ease;
                text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 0 1px #8b7355, inset 0 1px 0 rgba(255,255,255,0.3), 0 6px 16px rgba(0,0,0,0.8)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 0 0 1px #8b7355, inset 0 1px 0 rgba(255,255,255,0.2), inset 0 -1px 0 rgba(0,0,0,0.5), 0 4px 12px rgba(0,0,0,0.6)'"><span style="font-size: 1.2em;">‚öîÔ∏è</span> Start Quest</button>
            
            <button id="btnLearnToPlay" class="menu-btn-secondary" aria-label="Learn how to play the game" role="button"><span style="font-size: 1.1em;">üìö</span> Learn to Play</button>
            
            <button id="btnWelcomeLeaderboard" class="menu-btn-secondary" aria-label="View hall of fame leaderboard" role="button"><span style="font-size: 1.1em;">üèÜ</span> Hall of Fame</button>
            
            <button id="btnWelcomeSoundboard" class="menu-btn-secondary"><span style="font-size: 1.1em;">üéµ</span> Music Chamber</button>
            
            <button id="btnCodex" class="menu-btn-secondary" aria-label="Open codex (upgrades, relics, achievements)" role="button"><span style="font-size: 1.1em;">üìö</span> Codex</button>
            
            <button id="btnGoogleLogin" class="menu-btn-secondary"><span style="font-size: 1.1em;">‚òÅÔ∏è</span> Cloud Sync</button>
        </div>
        
        <!-- Music Controls (Minimalist) -->
        <div style="width: 100%; max-width: 420px;">
            <div id="nowPlayingDisplay" style="
                text-align: center;
                color: #8b7355;
                font-size: clamp(0.75em, 2vw, 0.9em);
                margin-bottom: 12px;
                font-family: 'Cinzel', serif;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                opacity: 0.8;
            ">Dark Awakening</div>
            <div style="display: flex; gap: 10px; justify-content: center; align-items: center;">
                <button id="btnWelcomeMusicToggle" title="Play/Pause Music">‚èØÔ∏è</button>
                <input type="range" id="welcomeMusicVolume" min="0" max="100" value="40" title="Music Volume">
            </div>
        </div>
        
        <!-- Bottom Right Container (Credits + Buttons) -->
        <div style="
            position: fixed;
            bottom: 15px;
            right: 15px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        ">
            <!-- Game Credits -->
            <div style="
                padding: 4px 10px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 4px;
                font-family: 'Cinzel', serif;
                font-size: 0.7em;
                color: rgba(201, 169, 97, 0.6);
                text-align: right;
                letter-spacing: 0.05em;
                text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
                pointer-events: none;
                height: 36px;
                min-height: 36px;
                display: flex;
                align-items: center;
            ">
                a game by <span style="color: rgba(201, 169, 97, 0.85); font-weight: 600;">Gabriel Lima</span>
            </div>
            
            <!-- Bug Report Button -->
            <button onclick="document.getElementById('bugReportModal').classList.add('active');" style="
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 8px 12px;
                height: 36px;
                min-height: 36px;
                background: linear-gradient(135deg, rgba(61, 51, 40, 0.85) 0%, rgba(42, 35, 24, 0.9) 100%);
                border: 1px solid rgba(201, 169, 97, 0.4);
                border-radius: 6px;
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.05),
                    0 2px 12px rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                cursor: pointer;
                transition: all 0.3s ease;
            " onmouseover="this.style.borderColor='rgba(201, 169, 97, 0.8)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='rgba(201, 169, 97, 0.4)'; this.style.transform='translateY(0)';" title="Report a bug">
                <span style="
                    font-size: 0.95em;
                    filter: drop-shadow(0 0 3px rgba(201, 169, 97, 0.5));
                ">üêõ</span>
                <span style="
                    font-family: 'Cinzel', serif;
                    font-size: 0.75em;
                    font-weight: 600;
                    color: #c9a961;
                    text-transform: uppercase;
                    letter-spacing: 0.08em;
                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
                ">Report Bug</span>
            </button>

            <!-- Contact Button -->
            <button onclick="document.getElementById('contactModal').classList.add('active');" style="
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 8px 12px;
                height: 36px;
                min-height: 36px;
                background: linear-gradient(135deg, rgba(61, 51, 40, 0.85) 0%, rgba(42, 35, 24, 0.9) 100%);
                border: 1px solid rgba(201, 169, 97, 0.4);
                border-radius: 6px;
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.05),
                    0 2px 12px rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                cursor: pointer;
                transition: all 0.3s ease;
            " onmouseover="this.style.borderColor='rgba(201, 169, 97, 0.8)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='rgba(201, 169, 97, 0.4)'; this.style.transform='translateY(0)';" title="Contact developer">
                <span style="
                    font-size: 0.95em;
                    filter: drop-shadow(0 0 3px rgba(201, 169, 97, 0.5));
                ">üìß</span>
                <span style="
                    font-family: 'Cinzel', serif;
                    font-size: 0.75em;
                    font-weight: 600;
                    color: #c9a961;
                    text-transform: uppercase;
                    letter-spacing: 0.08em;
                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
                ">Contact</span>
            </button>

            <!-- Version Badge -->
            <div onclick="document.getElementById('versionModal').classList.add('active');" style="
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 8px 12px;
                height: 36px;
                min-height: 36px;
                background: linear-gradient(135deg, rgba(61, 51, 40, 0.85) 0%, rgba(42, 35, 24, 0.9) 100%);
                border: 1px solid rgba(201, 169, 97, 0.4);
                border-radius: 6px;
                box-shadow: 
                    inset 0 1px 0 rgba(255, 255, 255, 0.05),
                    0 2px 12px rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                cursor: pointer;
                transition: all 0.3s ease;
            " onmouseover="this.style.borderColor='rgba(201, 169, 97, 0.8)'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='rgba(201, 169, 97, 0.4)'; this.style.transform='translateY(0)';" title="Click to see what's new!">
                <span style="
                    font-size: 0.95em;
                    filter: drop-shadow(0 0 3px rgba(201, 169, 97, 0.5));
                ">üöÄ</span>
                <span style="
                    font-family: 'Cinzel', serif;
                    font-size: 0.75em;
                    font-weight: 600;
                    color: #c9a961;
                    text-transform: uppercase;
                    letter-spacing: 0.08em;
                    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
                " id="gameVersionBadge">v1.4.3</span>
            </div>
        </div>
        
        </div> <!-- Close content container -->
    </div>

    <!-- ============================================ -->
    <!-- MAIN GAME WRAPPER (HIDDEN)
    <!-- ============================================ -->
    <div class="game-wrapper" id="gameWrapper">

        <!-- TOP BAR (STATS, GOLD, SETTINGS) -->
        <div class="top-bar">
            <div class="stats-group">
                <div class="stat-display" id="top-bar-health" title="Current / Max Health" role="status" aria-live="polite">
                    ‚ù§Ô∏è <span class="stat-value" id="health" aria-label="Current health">20</span>
                </div>
                <div class="stat-display" id="top-bar-gold" title="Gold" role="status">
                    ü™ô <span class="stat-value" id="goldAmount" aria-label="Gold amount">0</span>
                </div>
                 <!-- Score removed from here -->
                <div class="stat-display" id="top-bar-dungeon" title="Cards left in Dungeon">
                    üè∞ <span class="stat-value" id="dungeonCount">0</span>
                </div>
                <div class="stat-display" id="top-bar-rooms" title="Rooms Cleared">
                    üö™ <span class="stat-value" id="statRooms">0</span>
                </div>
            </div>
            
            <!-- CENTER GROUP: Relics + Timer + Achievements - ABSOLUTE CENTER -->
            <div style="position: absolute; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; align-items: center;">
                <div class="achievements-compact" id="btnTopRelics" title="üìñ Quick access to Relics encyclopedia - View all relics, their effects, and rarities" style="cursor: pointer; transition: all 0.2s ease;">
                    üìñ <span class="achievement-counter">Relics</span>
                </div>
                <div class="stat-display" id="gameTimer" title="Elapsed Time" style="font-size: 1.1em; font-weight: bold; color: #ffd700;">
                    ‚è±Ô∏è <span class="stat-value">00:00</span>
                </div>
                <div class="achievements-compact" id="achievementsCompact" title="Click to view all achievements" style="cursor: pointer;">
                    üèÜ <span class="achievement-counter" id="achievementCounter">0/50</span>
                </div>
            </div>
            
            <div class="settings-group">
                <div class="music-controls">
                    <button class="settings-btn" id="btnMusicToggle" title="Play/Pause Music">‚ñ∂Ô∏è</button>
                    <input type="range" id="musicVolume" min="0" max="100" value="40" title="Music Volume" 
                           style="width: 80px; height: 20px; vertical-align: middle; margin: 0 5px; cursor: pointer;">
                </div>
                
                <button class="settings-btn btn-danger-style" id="btnTopGiveUp" title="Give Up Run" onclick="tryGiveUp();">üè≥Ô∏è</button>
            </div>
        </div>

        <!-- CENTER AREA (RELICS, STAGE, HOLD) -->
        <div class="center-area">
            
            <!-- LEFT PANEL (PLAYER, RELICS, SHOP) -->
            <div class="left-sidebar">
                <!-- Player Class Info - REDESIGNED -->
                <div style="
                    background: linear-gradient(135deg, rgba(201,169,97,0.2) 0%, rgba(42,35,24,0.9) 100%);
                    border: 3px solid #d4af37;
                    border-radius: 15px;
                    padding: 20px 15px;
                    margin-bottom: 15px;
                    box-shadow: 0 6px 20px rgba(212,175,55,0.5);
                    text-align: center;
                ">
                    <!-- Large Avatar -->
                    <img id="playerAvatar" src="" alt="Avatar" style="
                        width: 130px;
                        height: 130px;
                        border-radius: 12px;
                        border: 4px solid #ffd700;
                        object-fit: cover;
                        box-shadow: 0 2px 10px rgba(255,215,0,0.4);
                        margin: 0 auto 12px auto;
                        display: block;
                    ">
                    
                    <!-- Player Info -->
                    <div id="playerNameDisplay" style="
                        color: #ffd700;
                        font-weight: bold;
                        font-size: 1.3em;
                        font-family: 'Cinzel', serif;
                        text-shadow: 0 2px 6px rgba(0,0,0,0.9);
                        margin-bottom: 5px;
                    "></div>
                    <div id="playerClassDisplay" style="
                        color: #d4af37;
                        font-size: 0.9em;
                        text-transform: uppercase;
                        letter-spacing: 2px;
                        font-weight: 700;
                        margin-bottom: 12px;
                    "></div>
                    
                    <!-- Passive Icons Display -->
                    <div id="passiveIconsDisplay" style="
                        display: flex;
                        gap: 6px;
                        flex-wrap: wrap;
                        justify-content: center;
                        padding-top: 12px;
                        border-top: 2px solid rgba(212,175,55,0.5);
                    ">
                        <!-- Passive icons will be added here dynamically -->
                    </div>
                </div>
                
                <div class="relics-panel" id="relicsPanel">
                    <div class="sidebar-label">Relics</div>
                    <div id="relicsList">
                        <div class="empty-slot">No Relics Yet</div>
                    </div>
                </div>
                <div class="sidebar-action">
                    <button class="btn-shop" id="btnOpenShop">üè∫ Merchant</button>
                </div>
            </div>

            <!-- CENTER STAGE (WEAPON, MESSAGES, CONTROLS) -->
            <div class="center-stage">
                
                <div id="messageArea">
                    <!-- Messages appear here -->
                </div>

                <!-- NEW SCORE DISPLAY -->
                <div class="score-display" id="mainScoreDisplay">
                    <div class="score-label">SCORE</div>
                    <div class="score-value" id="mainScoreValue">0</div>
                </div>

                <div id="center-stage-weapon">
                    <div class="center-stage-label">Equipped Weapon</div>
                    <div class="cards-row" id="equippedWeapon">
                        <div class="empty-slot">No Weapon</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="btnDrawRoom" disabled>‚öîÔ∏è Enter Chamber</button>
                    <button class="btn btn-success" id="btnAvoidRoom" disabled>üõ°Ô∏è Evade</button>
                    <button class="btn btn-warning" id="btnUndo" disabled style="display: none;">‚Ü©Ô∏è Undo Last Move</button>
                </div>
            </div>

            <!-- RIGHT PANEL (ABILITY, HOLD, DISCARD, TIMER) -->
            <div class="right-sidebar">
                <!-- Class Ability Button - COMPACT -->
                <div style="
                    margin-bottom: 15px;
                    background: linear-gradient(135deg, rgba(201,169,97,0.1) 0%, rgba(42,35,24,0.6) 100%);
                    border: 2px solid #d4af37;
                    border-radius: 10px;
                    padding: 10px;
                    box-shadow: 0 3px 12px rgba(212,175,55,0.3);
                ">
                    <button id="btnClassAbility" class="btn btn-primary" style="
                        width: 100%;
                        padding: 10px 8px;
                        font-size: 0.9em;
                        font-family: 'Cinzel', serif;
                        background: linear-gradient(180deg, #ffd700 0%, #c9a961 100%);
                        border: 2px solid #d4af37;
                        color: #1a1410;
                        font-weight: bold;
                        position: relative;
                        border-radius: 8px;
                        box-shadow: 0 3px 8px rgba(255,215,0,0.4);
                        transition: all 0.3s ease;
                        cursor: pointer;
                    " 
                    onmouseover="if(!this.disabled) { this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 12px rgba(255,215,0,0.6)'; }"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 8px rgba(255,215,0,0.4)';"
                    title="Class special ability">
                        <span id="abilityIcon" style="font-size: 1.3em; margin-right: 5px;">‚ú®</span>
                        <span id="abilityName" style="font-size: 0.85em;">Ability</span>
                        <div id="abilityCooldownDisplay" style="
                            position: absolute;
                            top: 3px;
                            right: 3px;
                            font-size: 0.6em;
                            background: rgba(255,107,107,0.95);
                            padding: 2px 6px;
                            border-radius: 10px;
                            color: #fff;
                            font-weight: bold;
                            box-shadow: 0 1px 3px rgba(0,0,0,0.5);
                        "></div>
                    </button>
                    <div id="abilityDescription" style="
                        font-size: 0.65em;
                        color: #d4af37;
                        text-align: center;
                        margin-top: 6px;
                        padding: 6px;
                        background: rgba(0,0,0,0.4);
                        border-radius: 5px;
                        line-height: 1.3;
                        border: 1px solid rgba(201,169,97,0.2);
                    "></div>
                </div>
                
                <div class="hold-area">
                    <div class="sidebar-label hold-label">Held Card</div>
                    <div id="holdAreaContainer">
                        <div class="empty-slot" id="holdSlotPlaceholder" style="font-size: 0.85em; line-height: 1.3;">Tap & hold any card<br>to save for later</div>
                    </div>
                </div>
                
                <div class="sidebar-label discard-label">Discard</div>
                <div id="discardPilePreview">
                    <!-- Discard mini-cards -->
                </div>
                
                <!-- Timer moved to top-bar -->
            </div>

        </div>

        <!-- BOTTOM BAR (ROOM / "HAND") -->
        <div class="bottom-bar" id="room">
            <!-- The 4 room cards appear here -->
            <div class="empty-slot">Click "Enter Dungeon" to start</div>
        </div>
    </div>


    <!-- ============================================ -->
    <!-- MODALS
    <!-- ============================================ -->

    <!-- Modal: New Game -->
    <div class="modal-overlay" id="newGameModal">
        <div class="modal-content" style="max-width: 600px !important; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="document.getElementById('newGameModal').classList.remove('active');">‚úï</button>
            <h2>‚ú® New Game</h2>
            <div class="form-group">
                <label for="playerNameInput">üë§ Player Name (3-10 characters) *</label>
                <input type="text" id="playerNameInput" placeholder="Enter your name" minlength="3" maxlength="10" required>
                <div id="nameError" style="display: none; color: #ff6b6b; font-size: 0.9em; margin-top: 5px; font-weight: bold;"></div>
                <small style="color: #aaa; font-size: 0.85em;">Minimum 3, maximum 10 characters</small>
            </div>
            <div class="form-group">
                <label>üî• Difficulty</label>
                <div class="difficulty-selector" id="difficultySelector">
                    <button class="difficulty-btn easy" data-difficulty="easy">
                        üü¢ Easy<br><small>20 HP | 30 ü™ô</small>
                    </button>
                    <button class="difficulty-btn normal selected" data-difficulty="normal">
                        üü° Normal<br><small>15 HP | 15 ü™ô</small>
                    </button>
                    <button class="difficulty-btn hard" data-difficulty="hard">
                        üî¥ Hard<br><small>10 HP | 0 ü™ô</small>
                    </button>
                    <button class="difficulty-btn endless" data-difficulty="endless">
                        üíé Endless<br><small>15 HP | 15 ü™ô</small>
                    </button>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 0.9em; color: #ddd; line-height: 1.5;">
                    <strong>‚öîÔ∏è Weapon Durability:</strong> Easy: 3 | Normal: 2 | Hard: 1 | Endless: 2
                    <br><br><strong>üíé Gold & Events:</strong>
                    <br>‚Ä¢ <strong>üü¢ Easy:</strong> More gold & events (40%)
                    <br>‚Ä¢ <strong>üü° Normal:</strong> Balanced (30%)
                    <br>‚Ä¢ <strong>üî¥ Hard:</strong> Less gold & events (20%)
                    <br><br><strong>‚Ü©Ô∏è Undo:</strong> Available on Easy & Normal only
                    <br><br><strong>üëπ Boss Battles:</strong> 2 Minibosses (room 15 & 25) + Final Boss!
                    <br><br><strong>Higher difficulty = Bigger score multiplier!</strong>
                </div>
            </div>
            <div class="modal-controls">
                <button class="btn btn-success" id="btnStartGameModal">‚öîÔ∏è Start Quest!</button>
                <button class="btn btn-secondary" id="btnCancelStart">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Class Selection -->
    <div class="modal-overlay" id="classSelectionModal">
        <div class="modal-content" style="max-width: 1000px !important; width: 90vw !important; padding: 40px 30px !important;">
            <h2 id="classSelectionTitle" style="text-align: center; font-family: 'Cinzel', serif; color: #c9a961; margin-bottom: 10px;">‚öîÔ∏è SELECT YOUR HERO</h2>
            <p id="classSelectionSubtitle" style="text-align: center; color: #8b7355; font-size: 0.9em; margin-bottom: 20px; min-height: 20px;"></p>
            
            <!-- Class Avatars (Horizontal) -->
            <div style="display: flex; gap: 20px; margin-bottom: 25px; justify-content: center; flex-wrap: wrap;">
                <!-- Scoundrel -->
                <div class="class-card" data-class="scoundrel" style="
                    background: linear-gradient(180deg, #2a2318 0%, #1a1410 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                    flex: 0 0 auto;
                    width: 240px;
                    box-sizing: border-box;
                " onmouseover="this.style.borderColor='#c9a961'; this.style.transform='translateY(-5px)'" onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)' }">
                    <div style="width: 216px; height: 324px; overflow: hidden; border-radius: 4px; border: 2px solid #5a4a38; margin: 0 auto 8px auto;">
                        <picture>
                            <source srcset="assets/images/avatar-scoundrel.webp" type="image/webp">
                            <img src="assets/images/avatar-scoundrel.webp" alt="Scoundrel" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;"  width="832" height="1099">
                        </picture>
                    </div>
                    <h3 style="color: #c9a961; font-family: 'Cinzel', serif; margin: 0; font-size: 1em;">SCOUNDREL</h3>
                </div>
                
                <!-- Knight -->
                <div class="class-card" data-class="knight" style="
                    background: linear-gradient(180deg, #2a2318 0%, #1a1410 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                    flex: 0 0 auto;
                    width: 240px;
                    box-sizing: border-box;
                " onmouseover="this.style.borderColor='#c9a961'; this.style.transform='translateY(-5px)'" onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)' }">
                    <div style="width: 216px; height: 324px; overflow: hidden; border-radius: 4px; border: 2px solid #5a4a38; margin: 0 auto 8px auto;">
                        <picture>
                            <source srcset="assets/images/avatar-knight.webp" type="image/webp">
                            <img src="assets/images/avatar-knight.webp" alt="Knight" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;"  width="1024" height="1536">
                        </picture>
                    </div>
                    <h3 style="color: #c9a961; font-family: 'Cinzel', serif; margin: 0; font-size: 1em;">KNIGHT</h3>
                </div>
                
                <!-- Rogue -->
                <div class="class-card" data-class="rogue" style="
                    background: linear-gradient(180deg, #2a2318 0%, #1a1410 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                    flex: 0 0 auto;
                    width: 240px;
                    box-sizing: border-box;
                " onmouseover="this.style.borderColor='#c9a961'; this.style.transform='translateY(-5px)'" onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)' }">
                    <div style="width: 216px; height: 324px; overflow: hidden; border-radius: 4px; border: 2px solid #5a4a38; margin: 0 auto 8px auto;">
                        <picture>
                            <source srcset="assets/images/avatar-rogue.webp" type="image/webp">
                            <img src="assets/images/avatar-rogue.webp" alt="Rogue" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;"  width="1024" height="1536">
                        </picture>
                    </div>
                    <h3 style="color: #c9a961; font-family: 'Cinzel', serif; margin: 0; font-size: 1em;">ROGUE</h3>
                </div>
                
                <!-- Dancer -->
                <div class="class-card" data-class="dancer" style="
                    background: linear-gradient(180deg, #2a2318 0%, #1a1410 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                    flex: 0 0 auto;
                    width: 240px;
                    box-sizing: border-box;
                " onmouseover="this.style.borderColor='#c9a961'; this.style.transform='translateY(-5px)'" onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)' }">
                    <div style="width: 216px; height: 324px; overflow: hidden; border-radius: 4px; border: 2px solid #5a4a38; margin: 0 auto 8px auto;">
                        <picture>
                            <source srcset="assets/images/avatar-dancer.webp" type="image/webp">
                            <img src="assets/images/avatar-dancer.webp" alt="Dancer" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;"  width="1024" height="1536">
                        </picture>
                    </div>
                    <h3 style="color: #c9a961; font-family: 'Cinzel', serif; margin: 0; font-size: 1em;">DANCER</h3>
                </div>
                
                <!-- Berserker -->
                <div class="class-card" data-class="berserker" style="
                    background: linear-gradient(180deg, #2a2318 0%, #1a1410 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                    flex: 0 0 auto;
                    width: 240px;
                    box-sizing: border-box;
                " onmouseover="this.style.borderColor='#c9a961'; this.style.transform='translateY(-5px)'" onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)' }">
                    <div style="width: 216px; height: 324px; overflow: hidden; border-radius: 4px; border: 2px solid #5a4a38; margin: 0 auto 8px auto;">
                        <picture>
                            <source srcset="assets/images/avatar-berserker.webp" type="image/webp">
                            <img src="assets/images/avatar-berserker.webp" alt="Berserker" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;"  width="712" height="982">
                        </picture>
                    </div>
                    <h3 style="color: #c9a961; font-family: 'Cinzel', serif; margin: 0; font-size: 1em;">BERSERKER</h3>
                </div>
                
                <!-- Priest -->
                <div class="class-card" data-class="priest" style="
                    background: linear-gradient(180deg, #2a2318 0%, #1a1410 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    text-align: center;
                    flex: 0 0 auto;
                    width: 240px;
                    box-sizing: border-box;
                " onmouseover="this.style.borderColor='#c9a961'; this.style.transform='translateY(-5px)'" onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)' }">
                    <div style="width: 216px; height: 324px; overflow: hidden; border-radius: 4px; border: 2px solid #5a4a38; margin: 0 auto 8px auto;">
                        <picture>
                            <source srcset="assets/images/avatar-priest.webp" type="image/webp">
                            <img src="assets/images/avatar-priest.webp" alt="Priest" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; display: block;"  width="832" height="1099">
                        </picture>
                    </div>
                    <h3 style="color: #c9a961; font-family: 'Cinzel', serif; margin: 0; font-size: 1em;">PRIEST</h3>
                </div>
            </div>
            
            <!-- Class Description -->
            <div id="classDescription" style="
                background: rgba(0,0,0,0.4);
                border: 1px solid #5a4a38;
                border-radius: 8px;
                padding: 20px;
                min-height: 150px;
                margin-bottom: 20px;
                display: none;
            ">
                <h3 id="classDescTitle" style="color: #c9a961; font-family: 'Cinzel', serif; margin-top: 0;"></h3>
                <p id="classDescMotivation" style="color: #d4af37; font-style: italic; margin-bottom: 15px;"></p>
                <p id="classDescMechanics" style="color: #ddd; line-height: 1.6;"></p>
            </div>
            
            <div class="modal-controls">
                <button class="btn btn-success" id="btnConfirmClass" disabled>‚öîÔ∏è Begin Adventure!</button>
                <button class="btn btn-secondary" id="btnCancelClass">Back</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Interactive Tutorial -->
    <div class="modal-overlay" id="interactiveTutorialModal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="document.getElementById('interactiveTutorialModal').classList.remove('active');">‚úï</button>
            <h2 id="tutorialStepTitle">üéÆ Interactive Tutorial</h2>
            <div id="tutorialStepContent" style="min-height: 300px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 8px; margin: 20px 0;">
                <!-- Dynamic content here -->
            </div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-secondary" id="btnTutorialPrev" disabled>‚¨ÖÔ∏è Previous</button>
                <button class="btn btn-primary" id="btnTutorialNext">‚û°Ô∏è Next</button>
                <button class="btn btn-secondary" id="btnTutorialSkip">‚è© Skip Tutorial</button>
            </div>
            <div style="text-align: center; margin-top: 15px; color: #aaa; font-size: 0.9em;">
                Step <span id="tutorialCurrentStep">1</span> of <span id="tutorialTotalSteps">8</span>
            </div>
        </div>
    </div>
    
    <!-- Modal: Learn to Play Selection -->
    <div class="modal-overlay" id="learnToPlayModal" role="dialog" aria-modal="true" aria-labelledby="learnToPlayTitle">
        <div class="modal-content" style="max-width: 600px; padding: 40px;">
            <button class="modal-close-btn" onclick="document.getElementById('learnToPlayModal').classList.remove('active');" aria-label="Close learn to play modal">‚úï</button>
            <h2 id="learnToPlayTitle" style="text-align: center; color: #c9a961; margin-bottom: 30px; font-size: 2em;">üìö Learn to Play</h2>
            
            <p style="text-align: center; color: #c9a961; margin-bottom: 30px; font-size: 1.05em;">
                Choose how you want to learn:
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button id="btnStartInteractiveTutorial" style="
                    font-family: 'Cinzel', serif;
                    font-size: 1em;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 0.08em;
                    padding: 18px 24px;
                    background: linear-gradient(180deg, #c9a961 0%, #a68948 100%);
                    border: 2px solid #d4af37;
                    border-radius: 8px;
                    box-shadow: 
                        0 0 0 1px #8b7355,
                        inset 0 1px 0 rgba(255, 255, 255, 0.2),
                        0 4px 12px rgba(0, 0, 0, 0.6);
                    color: #1a1410;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    text-align: left;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 0 1px #8b7355, inset 0 1px 0 rgba(255,255,255,0.3), 0 6px 16px rgba(0,0,0,0.8)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 0 0 1px #8b7355, inset 0 1px 0 rgba(255,255,255,0.2), 0 4px 12px rgba(0,0,0,0.6)'">
                    <div style="font-size: 1.3em; margin-bottom: 8px;">üéì Interactive Tutorial</div>
                    <div style="font-size: 0.8em; font-weight: 400; opacity: 0.8; letter-spacing: 0.05em; text-transform: none;">
                        Play through a guided tutorial with step-by-step instructions
                    </div>
                </button>
                
                <button id="btnOpenRulesReference" style="
                    font-family: 'Cinzel', serif;
                    font-size: 1em;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 0.08em;
                    padding: 18px 24px;
                    background: linear-gradient(180deg, #3d3328 0%, #2a2318 100%);
                    border: 2px solid #5a4a38;
                    border-radius: 8px;
                    box-shadow: 
                        inset 0 1px 0 rgba(255, 255, 255, 0.05),
                        0 2px 8px rgba(0, 0, 0, 0.5);
                    color: #c9a961;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    text-align: left;
                " onmouseover="this.style.background='linear-gradient(180deg, #4a3d2f 0%, #342820 100%)'; this.style.borderColor='#6b5a48'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='linear-gradient(180deg, #3d3328 0%, #2a2318 100%)'; this.style.borderColor='#5a4a38'; this.style.transform='translateY(0)'">
                    <div style="font-size: 1.3em; margin-bottom: 8px;">üìñ Rules Reference</div>
                    <div style="font-size: 0.8em; font-weight: 400; opacity: 0.8; letter-spacing: 0.05em; text-transform: none;">
                        Read the complete game rules and mechanics at your own pace
                    </div>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Rules Reference -->
    <div class="modal-overlay" id="tutorialModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="document.getElementById('tutorialModal').classList.remove('active');">‚úï</button>
            <h2>üìñ Rules Reference</h2>
            
            <div class="tutorial-section">
                <h3>üéØ Objective</h3>
                <p>Clear all cards from the Dungeon deck without your health reaching zero!</p>
            </div>

            <div class="tutorial-section">
                <h3>üéÆ Gameplay</h3>
                <p><strong>1. Start the Action:</strong></p>
                <p>‚Ä¢ Choose <strong>"Enter Dungeon"</strong> (draws 4 cards) or <strong>"Avoid Dungeon"</strong> (discards 3 cards from the top). You cannot avoid two dungeons in a row.</p>
                <p><strong>2. Clear the Dungeon:</strong></p>
                <p>‚Ä¢ You must use or discard all 4 cards from the dungeon (in the bottom bar) to advance.</p>
            </div>

            <div class="tutorial-section">
                <h3>üÉè Card Types</h3>
                <p>
                    <span class="tutorial-card-demo monster">‚ô†Ô∏è ‚ô£Ô∏è Monsters (Spades & Clubs)</span>
                    <br>Click to fight. You take damage = (Monster Value) - (Your Weapon Value). If your weapon is stronger, you take no damage.
                </p>
                <p>
                    <span class="tutorial-card-demo weapon">‚ô¶Ô∏è Weapons (Diamonds)</span>
                    <br>Click to equip. Replaces your current weapon.
                </p>
                <p>
                    <span class="tutorial-card-demo potion">‚ô•Ô∏è Potions (Hearts)</span>
                    <br>Click to heal. Limit of 1 potion per dungeon!
                </p>
            </div>

            <div class="tutorial-section">
                <h3>üìç "Hold" System</h3>
                <p><strong>Tap & hold</strong> (or <strong>right-click</strong> on desktop) cards in the room (bottom bar) to save them in the "Held" area (right sidebar).</p>
                <p>‚Ä¢ <strong>Can hold:</strong> Weapons ‚öîÔ∏è, Potions üíä, and Specials ‚ú®</p>
                <p>‚Ä¢ <strong>Cannot hold:</strong> Monsters üëπ (must be fought immediately!)</p>
                <p>‚Ä¢ Only 1 card can be held at a time.</p>
                <p>‚Ä¢ Tap the held card to use it immediately (returns to room).</p>
                <p>‚Ä¢ <strong>Strategy:</strong> Hold a weapon to skip it now and equip later, or hold a potion for when you need it most!</p>
            </div>
            
            <div class="tutorial-section">
                <h3>‚öîÔ∏è Weapon Durability</h3>
                <p>Weapons break after use! Easy: 3 uses | Normal: 2 | Hard: 1</p>
                <p>‚Ä¢ Colored bar shows durability (üü¢ good, üü° medium, üî¥ low)</p>
                <p>‚Ä¢ Repair in shop or find üî® Durable Weapons relic for infinite durability</p>
                <p>‚Ä¢ <strong>‚õî Warning:</strong> Equipping a new weapon breaks your combo!</p>
            </div>
            
            <div class="tutorial-section">
                <h3>üî• Combo System</h3>
                <p><strong>Build combos by killing monsters without taking damage!</strong></p>
                <p>‚Ä¢ <strong>Combo increases:</strong> Perfect kills (no damage taken)</p>
                <p>‚Ä¢ <strong>Combo persists:</strong> Between rooms - keep it going!</p>
                <p>‚Ä¢ <strong>Combo breaks:</strong> Taking damage OR equipping a weapon</p>
                <p>‚Ä¢ <strong>Potions don't break combo</strong> - use them strategically!</p>
                <p>‚Ä¢ <strong>Visual rewards:</strong> 5x = GREAT!, 7x = AMAZING!, 10x = LEGENDARY!</p>
                <p>‚Ä¢ <strong>Score bonus:</strong> Max combo x10 points in final score</p>
            </div>
            
            <div class="tutorial-section">
                <h3>üëπ Boss Battles</h3>
                <p><strong>Every 10th room is a BOSS ROOM!</strong></p>
                <p>‚Ä¢ Bosses have <strong>15 HP</strong> and require multiple hits</p>
                <p>‚Ä¢ <strong>HP bar</strong> shows boss health (üü¢‚Üíüü°‚Üíüî¥)</p>
                <p>‚Ä¢ <strong>‚öîÔ∏è Critical:</strong> If you fight a boss <strong>WITHOUT a weapon</strong>:</p>
                <p>&nbsp;&nbsp;&nbsp;‚Ä¢ Boss attacks once and flees</p>
                <p>&nbsp;&nbsp;&nbsp;‚Ä¢ You take full damage (15 HP!)</p>
                <p>&nbsp;&nbsp;&nbsp;‚Ä¢ <strong>NO GOLD REWARD</strong></p>
                <p>‚Ä¢ <strong>üí° Strategy:</strong> Always have a weapon before room 10, 20, 30...</p>
            </div>
            
            <div class="tutorial-section">
                <h3>üí∞ Gold & Economy</h3>
                <p>‚Ä¢ <strong>Gold varies by difficulty:</strong> Easy = More | Normal = Balanced | Hard = Much less</p>
                <p>‚Ä¢ Get gold from: Monsters, rooms, relics, events</p>
                <p>‚Ä¢ <strong>üí° Tip:</strong> On Hard mode, every coin counts!</p>
            </div>
            
            <div class="tutorial-section">
                <h3>üè∫ Merchant & üîÆ Relics</h3>
                <p>‚Ä¢ <strong>Merchant:</strong> Click üè∫ MERCHANT to spend gold on heals, relics, and upgrades.</p>
                <p>‚Ä¢ <strong>Relics by Rarity:</strong></p>
                <p>&nbsp;&nbsp;&nbsp;‚ö™ Common (25ü™ô) - Basic bonuses</p>
                <p>&nbsp;&nbsp;&nbsp;üü¢ Uncommon (50ü™ô) - Moderate bonuses</p>
                <p>&nbsp;&nbsp;&nbsp;üîµ Rare (100ü™ô) - Powerful bonuses</p>
                <p>&nbsp;&nbsp;&nbsp;üü† Legendary (200ü™ô) - Game-changing!</p>
                <p>‚Ä¢ <strong>‚ö†Ô∏è Shop Penalty:</strong> Each shop visit costs -50 points in final score</p>
                <p>‚Ä¢ <strong>Events:</strong> üé≤ Random encounters after clearing rooms. Make choices!</p>
                <p>‚Ä¢ <strong>Upgrades:</strong> ‚≠ê Permanent progress that carries over between runs!</p>
            </div>
            
            <div class="tutorial-section">
                <h3>üèÜ Score System</h3>
                <p><strong>Victory score is calculated from multiple factors:</strong></p>
                <p>‚Ä¢ <strong>Base Bonuses:</strong></p>
                <p>&nbsp;&nbsp;&nbsp;üéØ Win Bonus: +1000</p>
                <p>&nbsp;&nbsp;&nbsp;‚ù§Ô∏è Health: HP x 20</p>
                <p>&nbsp;&nbsp;&nbsp;üí∞ Gold: Total earned x 5</p>
                <p>&nbsp;&nbsp;&nbsp;üî• Combo: Max combo x 10</p>
                <p>&nbsp;&nbsp;&nbsp;‚öîÔ∏è Monsters: Slain x 2</p>
                <p>‚Ä¢ <strong>Special Bonuses:</strong></p>
                <p>&nbsp;&nbsp;&nbsp;‚ö° Speedrun: +1000 (<1 min) or +500 (1-5 min)</p>
                <p>&nbsp;&nbsp;&nbsp;üèÜ Perfect Run: +1000 (no damage taken!)</p>
                <p>‚Ä¢ <strong>Penalties:</strong></p>
                <p>&nbsp;&nbsp;&nbsp;‚è±Ô∏è Time: -2 points per second</p>
            </div>
            
            <div class="tutorial-section" style="background: rgba(255, 215, 0, 0.1); border: 2px solid #ffd700; padding: 15px; border-radius: 8px;">
                <h3>üí° Pro Tips</h3>
                <p>‚Ä¢ <strong>Combo strategy:</strong> Don't equip weapons mid-combo unless absolutely necessary</p>
                <p>‚Ä¢ <strong>Boss prep:</strong> Always check your weapon before room 10, 20, 30...</p>
                <p>‚Ä¢ <strong>Shop discipline:</strong> Each shop visit costs score - use it wisely!</p>
                <p>‚Ä¢ <strong>Speedrun tip:</strong> <1 minute = +1000 bonus! 1-5 min = +500!</p>
                <p>‚Ä¢ <strong>Perfect run:</strong> Take zero damage for +1000 bonus!</p>
                <p>‚Ä¢ <strong>Hold system:</strong> Save healing potions for emergencies</p>
            </div>
            
            <button class="close-modal-btn" id="btnCloseTutorial">Got it!</button>
        </div>
    </div>
    
    <!-- Modal: Leaderboard -->
    <div class="modal-overlay" id="leaderboardModal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close-btn" onclick="document.getElementById('leaderboardModal').classList.remove('active');">‚úï</button>
            <h2>üèÜ Hall of Fame (Top 10)</h2>
            
            <!-- Difficulty Tabs -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                <button class="difficulty-tab active" data-difficulty="easy" onclick="switchLeaderboardDifficulty('easy')">
                    üü¢ Easy
                </button>
                <button class="difficulty-tab" data-difficulty="normal" onclick="switchLeaderboardDifficulty('normal')">
                    üü° Normal
                </button>
                <button class="difficulty-tab" data-difficulty="hard" onclick="switchLeaderboardDifficulty('hard')">
                    üî¥ Hard
                </button>
                <button class="difficulty-tab" data-difficulty="endless" onclick="switchLeaderboardDifficulty('endless')">
                    ‚ôæÔ∏è Endless
                </button>
            </div>
            
            <div id="leaderboardList" style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                <p style="text-align: center; color: #aaa;">Loading scores...</p>
            </div>
            <button class="close-modal-btn" id="btnCloseLeaderboard">Close</button>
        </div>
    </div>
    
    <!-- Other Modals (Shop, Event, Unlocks) - Identical structure -->
    <div class="modal-overlay" id="shopModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeShopWrapper();">‚úï</button>
            <h2>üè∫ Merchant's Wares</h2>
            <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                Spend your gold wisely! (Gold: <span id="shopGoldAmount">0</span>)
            </p>
            <div id="shopItems" style="max-height: 400px; overflow-y: auto; padding-right: 10px;"></div>
            <button class="close-modal-btn" id="btnCloseShop" onclick="closeShopWrapper();">Leave Shop</button>
        </div>
    </div>

    <div class="modal-overlay" id="eventModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeEventWrapper();">‚úï</button>
            <h2 id="eventTitle">üé≤ Event</h2>
            <div class="event-text" id="eventText"></div>
            <div id="eventChoices"></div>
            <!-- Close button not needed, choice closes modal -->
        </div>
    </div>

    <div class="modal-overlay" id="unlocksModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="document.getElementById('unlocksModal').classList.remove('active');">‚úï</button>
            <h2>‚≠ê Permanent Upgrades</h2>
            <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                Progress that continues between runs!
            </p>
            <div id="unlocksList" style="max-height: 400px; overflow-y: auto; padding-right: 10px;"></div>
            <button class="close-modal-btn" id="btnCloseUnlocks">Close</button>
        </div>
    </div>
    
    
    <!-- Modal: Achievements -->
    <div class="modal-overlay" id="achievementsModal">
        <div class="modal-content" style="max-width: 900px;">
            <button class="modal-close-btn" onclick="document.getElementById('achievementsModal').classList.remove('active');">‚úï</button>
            <h2>üèÜ Achievements</h2>
            <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                <span id="achievementStats">0/50 Unlocked</span> | 
                ü•â <span id="bronzeCount">0/25</span> | 
                ü•à <span id="silverCount">0/15</span> | 
                ü•á <span id="goldCount">0/9</span> | 
                üíé <span id="platinumCount">0/1</span>
            </p>
            <div id="achievementsList" class="achievements-grid"></div>
            <button class="close-modal-btn" id="btnCloseAchievements">Close</button>
        </div>
    </div>
    
    <!-- Modal: Soundboard -->
    <div class="modal-overlay" id="soundboardModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close-btn" onclick="document.getElementById('soundboardModal').classList.remove('active');">‚úï</button>
            <h2>üéµ Music Chamber</h2>
            <p style="color: #aaa; margin-bottom: 20px;">Preview all atmospheric tracks from the game!</p>
            
            <div style="display: grid; gap: 15px;">
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 2px solid #8b7355;">
                    <h3 style="color: #d4af37; margin-bottom: 10px;">üè∞ Dark Awakening</h3>
                    <p style="color: #bbb; font-size: 0.9em; margin-bottom: 10px;">Menu Theme - Mysterious, inviting, dark</p>
                    <button class="btn btn-primary" id="btnPlayMenu" style="width: 100%;">‚ñ∂Ô∏è Play</button>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 2px solid #8b7355;">
                    <h3 style="color: #d4af37; margin-bottom: 10px;">‚öîÔ∏è Into the Depths</h3>
                    <p style="color: #bbb; font-size: 0.9em; margin-bottom: 10px;">Gameplay Theme - Tense, adventurous</p>
                    <button class="btn btn-primary" id="btnPlayGameplay" style="width: 100%;">‚ñ∂Ô∏è Play</button>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 2px solid #8b7355;">
                    <h3 style="color: #d4af37; margin-bottom: 10px;">üèõÔ∏è Merchant's Shadow</h3>
                    <p style="color: #bbb; font-size: 0.9em; margin-bottom: 10px;">Shop Theme - Calm, mysterious</p>
                    <button class="btn btn-primary" id="btnPlayShop" style="width: 100%;">‚ñ∂Ô∏è Play</button>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 2px solid #8b7355;">
                    <h3 style="color: #d4af37; margin-bottom: 10px;">üëë Champion's Glory</h3>
                    <p style="color: #bbb; font-size: 0.9em; margin-bottom: 10px;">Victory Theme - Triumphant, celebratory</p>
                    <button class="btn btn-primary" id="btnPlayVictory" style="width: 100%;">‚ñ∂Ô∏è Play</button>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 2px solid #8b7355;">
                    <h3 style="color: #d4af37; margin-bottom: 10px;">üíÄ The Final Darkness</h3>
                    <p style="color: #bbb; font-size: 0.9em; margin-bottom: 10px;">Defeat Theme - Dark, respectful</p>
                    <button class="btn btn-primary" id="btnPlayDefeat" style="width: 100%;">‚ñ∂Ô∏è Play</button>
                </div>
            </div>
            
            <button class="close-modal-btn" id="btnCloseSoundboard" style="margin-top: 20px;">Close</button>
        </div>
    </div>
    
    <!-- Modal: Give Up Confirmation -->
    <div class="modal-overlay" id="giveUpModal">
        <div class="modal-content" style="max-width: 500px; text-align: center;">
            <h2 style="color: #ff6b6b; margin-bottom: 20px;">‚ö†Ô∏è Give Up?</h2>
            <p style="color: #ddd; font-size: 1.1em; line-height: 1.6; margin-bottom: 25px;">
                Are you sure you want to give up this run?<br>
                <span style="color: #aaa; font-size: 0.9em;">All progress in this dungeon will be lost.</span>
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-secondary" id="btnCancelGiveUp" style="min-width: 120px;">Cancel</button>
                <button class="btn btn-primary" id="btnConfirmGiveUp" style="min-width: 120px; background: linear-gradient(135deg, #ff6b6b, #ee5a6f);">Give Up</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Codex (Unified) -->
    <div class="modal-overlay" id="codexModal">
        <div class="modal-content" style="max-width: 900px;">
            <button class="modal-close-btn" onclick="document.getElementById('codexModal').classList.remove('active');">‚úï</button>
            <h2>üìñ CODEX</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <p style="color: #aaa; font-size: 0.95em;">Your complete game encyclopedia</p>
            </div>
            
            <!-- Tab Navigation -->
            <div style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid #5a4a38; padding-bottom: 0;">
                <button onclick="switchCodexTab('upgrades')" id="codexTabUpgrades" class="codex-tab active" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: linear-gradient(180deg, #4a3d2f 0%, #342820 100%);
                    border: 2px solid #d4af37;
                    border-bottom: none;
                    border-radius: 8px 8px 0 0;
                    color: #d4af37;
                    font-family: 'Cinzel', serif;
                    font-weight: bold;
                    font-size: 0.95em;
                    cursor: pointer;
                    transition: all 0.2s ease;
                ">‚≠ê UPGRADES</button>
                
                <button onclick="switchCodexTab('relics')" id="codexTabRelics" class="codex-tab" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: linear-gradient(180deg, #3d3328 0%, #2a2318 100%);
                    border: 2px solid #5a4a38;
                    border-bottom: none;
                    border-radius: 8px 8px 0 0;
                    color: #c9a961;
                    font-family: 'Cinzel', serif;
                    font-weight: bold;
                    font-size: 0.95em;
                    cursor: pointer;
                    transition: all 0.2s ease;
                ">üìñ RELICS</button>
                
                <button onclick="switchCodexTab('achievements')" id="codexTabAchievements" class="codex-tab" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: linear-gradient(180deg, #3d3328 0%, #2a2318 100%);
                    border: 2px solid #5a4a38;
                    border-bottom: none;
                    border-radius: 8px 8px 0 0;
                    color: #c9a961;
                    font-family: 'Cinzel', serif;
                    font-weight: bold;
                    font-size: 0.95em;
                    cursor: pointer;
                    transition: all 0.2s ease;
                ">üèÖ ACHIEVEMENTS</button>
            </div>
            
            <!-- Tab Content: Upgrades -->
            <div id="codexContentUpgrades" class="codex-content" style="display: block;">
                <p style="text-align: center; color: #aaa; margin-bottom: 15px;">
                    Permanent progress that continues between runs!
                </p>
                <!-- Status Filter -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
                    <button onclick="filterUpgradesByStatus('all')" class="upgrade-filter-btn active" data-status="all" style="padding: 8px 16px; background: #4ecdc4; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 1; transition: all 0.2s ease;">All</button>
                    <button onclick="filterUpgradesByStatus('unlocked')" class="upgrade-filter-btn" data-status="unlocked" style="padding: 8px 16px; background: #6bcf7f; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">‚úÖ Unlocked</button>
                    <button onclick="filterUpgradesByStatus('available')" class="upgrade-filter-btn" data-status="available" style="padding: 8px 16px; background: #ffd93d; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">‚ú® Available</button>
                    <button onclick="filterUpgradesByStatus('locked')" class="upgrade-filter-btn" data-status="locked" style="padding: 8px 16px; background: #888; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">üîí Locked</button>
                </div>
                <div id="upgradesList" style="max-height: 450px; overflow-y: auto; padding-right: 10px;">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <!-- Tab Content: Relics -->
            <div id="codexContentRelics" class="codex-content" style="display: none;">
                <!-- Rarity Filter -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
                    <button onclick="filterRelicsByRarity('all')" class="rarity-filter-btn active" data-rarity="all" style="padding: 8px 16px; background: #4ecdc4; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em;">All</button>
                    <button onclick="filterRelicsByRarity('common')" class="rarity-filter-btn" data-rarity="common" style="padding: 8px 16px; background: #aaa; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em;">‚ö™ Common</button>
                    <button onclick="filterRelicsByRarity('uncommon')" class="rarity-filter-btn" data-rarity="uncommon" style="padding: 8px 16px; background: #6bcf7f; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em;">üü¢ Uncommon</button>
                    <button onclick="filterRelicsByRarity('rare')" class="rarity-filter-btn" data-rarity="rare" style="padding: 8px 16px; background: #4a9eff; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em;">üîµ Rare</button>
                    <button onclick="filterRelicsByRarity('legendary')" class="rarity-filter-btn" data-rarity="legendary" style="padding: 8px 16px; background: #ff9800; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em;">üü† Legendary</button>
                </div>
                <div id="relicsGlossary" style="max-height: 450px; overflow-y: auto; padding-right: 10px;">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <!-- Tab Content: Achievements -->
            <div id="codexContentAchievements" class="codex-content" style="display: none;">
                <p style="text-align: center; color: #aaa; margin-bottom: 15px;">
                    <span id="achievementStatsCodex">0/50 Unlocked</span> | 
                    ü•â <span id="bronzeCountCodex">0/25</span> | 
                    ü•à <span id="silverCountCodex">0/15</span> | 
                    ü•á <span id="goldCountCodex">0/9</span> | 
                    üíé <span id="platinumCountCodex">0/1</span>
                </p>
                <!-- Tier Filter -->
                <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
                    <button onclick="filterAchievementsByTier('all')" class="achievement-filter-btn active" data-tier="all" style="padding: 8px 16px; background: #4ecdc4; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 1; transition: all 0.2s ease;">All</button>
                    <button onclick="filterAchievementsByTier('bronze')" class="achievement-filter-btn" data-tier="bronze" style="padding: 8px 16px; background: #cd7f32; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">ü•â Bronze</button>
                    <button onclick="filterAchievementsByTier('silver')" class="achievement-filter-btn" data-tier="silver" style="padding: 8px 16px; background: #c0c0c0; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">ü•à Silver</button>
                    <button onclick="filterAchievementsByTier('gold')" class="achievement-filter-btn" data-tier="gold" style="padding: 8px 16px; background: #ffd700; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">ü•á Gold</button>
                    <button onclick="filterAchievementsByTier('platinum')" class="achievement-filter-btn" data-tier="platinum" style="padding: 8px 16px; background: #e5e4e2; border: none; border-radius: 6px; color: #000; font-weight: bold; cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.85em; opacity: 0.6; transition: all 0.2s ease;">üíé Platinum</button>
                                    </div>
                <div id="achievementsListCodex" style="max-height: 450px; overflow-y: auto; padding-right: 10px;">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <button class="close-modal-btn" onclick="document.getElementById('codexModal').classList.remove('active');" style="margin-top: 20px;">Close</button>
        </div>
    </div>
    
    <!-- Modal: Version / What's New -->
    <div class="modal-overlay" id="versionModal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close-btn" onclick="document.getElementById('versionModal').classList.remove('active');">‚úï</button>
            <h2>üöÄ What's New in v1.4.3</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <p style="color: #6bcf7f; font-size: 1.2em; font-weight: bold;">‚ö° Lighthouse Performance Update!</p>
                <p style="color: #aaa; font-size: 0.9em;">Released: November 26, 2025</p>
            </div>

            <div style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
                <!-- Lighthouse Optimizations -->
                <div style="background: rgba(107, 207, 127, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #6bcf7f;">
                    <h3 style="color: #6bcf7f; margin-top: 0;">‚ö° Lighthouse Optimizations</h3>
                    <p style="color: #ddd; margin-bottom: 10px;">Massive performance improvements based on Google Lighthouse audit!</p>
                    <ul style="color: #ddd; line-height: 1.8; font-size: 0.95em;">
                        <li><strong>Faster FCP:</strong> First Contentful Paint improved by ~40%</li>
                        <li><strong>Deferred Scripts:</strong> Non-blocking JavaScript loading</li>
                        <li><strong>Auto Minification:</strong> JS/CSS automatically compressed</li>
                        <li><strong>Critical CSS:</strong> Inline styles for instant render</li>
                    </ul>
                </div>

                <div style="background: rgba(78, 205, 196, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4ecdc4;">
                    <h3 style="color: #4ecdc4; margin-top: 0;">üõ†Ô∏è Combat System Fixes</h3>
                    <ul style="color: #ddd; line-height: 1.8;">
                        <li><strong>Rogue Fixed:</strong> Can now hold 2 cards as intended</li>
                        <li><strong>Dancer Fixed:</strong> Can use 2 potions per room</li>
                        <li><strong>Tooltips:</strong> Now correctly show class ability bonuses</li>
                        <li><strong>Modularized:</strong> Combat code reorganized for stability</li>
                    </ul>
                </div>
            </div>
            
            <button class="close-modal-btn" id="btnCloseVersion" onclick="document.getElementById('versionModal').classList.remove('active');">Got it!</button>
        </div>
    </div>
    
    <!-- Modal: Bug Report -->
    <div class="modal-overlay" id="bugReportModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close-btn" onclick="document.getElementById('bugReportModal').classList.remove('active'); hideHumanVerification();">‚úï</button>
            <h2>üêõ Report a Bug</h2>
            <div style="margin: 10px 0 12px; color: #aaa; font-size: 0.9em;">Describe the bug in detail. Technical info like browser and screen resolution will be sent automatically.</div>
            <textarea id="bugMessage" placeholder="Describe what happened, steps to reproduce, and expected behavior" style="width: 100%; min-height: 160px; resize: vertical; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 6px; padding: 10px;" oninput="updateCharacterCount()"></textarea>
            
            <!-- Character counter and validation -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 0.85em;">
                <div id="validationMessage" style="color: #ff6b6b; display: none;"></div>
                <div id="characterCount" style="color: #aaa;">0 / 2000</div>
            </div>
            
            <!-- Optional email for copy -->
            <div style="margin-top: 15px; padding: 12px; background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 6px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: #ddd;">
                    <input 
                        type="checkbox" 
                        id="sendCopyCheckbox" 
                        onchange="toggleEmailField()"
                        style="width: 16px; height: 16px; accent-color: #ffd700;"
                    >
                    <span style="font-size: 0.9em;">Send me a copy of this bug report</span>
                </label>
                <input 
                    type="email" 
                    id="userEmail" 
                    placeholder="your.email@example.com" 
                    style="width: 100%; margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 4px; display: none;"
                    oninput="validateEmail()"
                >
                <div id="emailValidation" style="color: #ff6b6b; font-size: 0.8em; margin-top: 5px; display: none;"></div>
            </div>
            
            <!-- Human Verification Section -->
            <div id="humanVerification" style="margin-top: 15px; padding: 12px; background: rgba(107, 207, 127, 0.1); border: 1px solid rgba(107, 207, 127, 0.3); border-radius: 6px; display: none;">
                <div style="color: #6bcf7f; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    ü§ñ <span>Human Verification</span>
                </div>
                <div style="color: #ddd; font-size: 0.9em; margin-bottom: 10px;">
                    Please solve this simple math problem to verify you're human:
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="mathQuestion" style="color: #ffd700; font-size: 1.1em; font-weight: bold;"></span>
                    <input 
                        type="number" 
                        id="mathAnswer" 
                        placeholder="Answer"
                        style="width: 80px; padding: 6px; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 4px; text-align: center;"
                    >
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 14px;">
                <button class="close-modal-btn" onclick="document.getElementById('bugReportModal').classList.remove('active'); hideHumanVerification();">Cancel</button>
                <button 
                    id="bugReportSubmit"
                    class="close-modal-btn" 
                    onclick="sendBugReport()"
                    style="background: linear-gradient(135deg, #6bcf7f, #2fbf71); border: none; color: #102015; cursor: pointer;">
                    Send
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Contact -->
    <div class="modal-overlay" id="contactModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close-btn" onclick="document.getElementById('contactModal').classList.remove('active'); resetContactForm();">‚úï</button>
            <h2>üìß Contact Developer</h2>
            <div style="margin: 10px 0 12px; color: #aaa; font-size: 0.9em;">Get in touch for feedback, suggestions, partnerships, or questions!</div>
            
            <!-- Name Field -->
            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #c9a961; font-size: 0.9em; margin-bottom: 6px; font-weight: 600;">Your Name *</label>
                <input 
                    type="text" 
                    id="contactName" 
                    placeholder="John Doe" 
                    style="width: 100%; padding: 10px; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 6px;"
                    oninput="validateContactForm()"
                >
            </div>
            
            <!-- Email Field -->
            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #c9a961; font-size: 0.9em; margin-bottom: 6px; font-weight: 600;">Your Email *</label>
                <input 
                    type="email" 
                    id="contactEmail" 
                    placeholder="your.email@example.com" 
                    style="width: 100%; padding: 10px; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 6px;"
                    oninput="validateContactForm()"
                >
            </div>
            
            <!-- Subject Dropdown -->
            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #c9a961; font-size: 0.9em; margin-bottom: 6px; font-weight: 600;">Subject *</label>
                <select 
                    id="contactSubject" 
                    style="width: 100%; padding: 10px; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 6px; cursor: pointer;"
                    onchange="validateContactForm()"
                >
                    <option value="">Select a subject...</option>
                    <option value="feedback">üí¨ Feedback</option>
                    <option value="suggestion">üí° Feature Suggestion</option>
                    <option value="partnership">ü§ù Partnership</option>
                    <option value="question">‚ùì Question</option>
                    <option value="other">üìù Other</option>
                </select>
            </div>
            
            <!-- Message Field -->
            <div style="margin-bottom: 12px;">
                <label style="display: block; color: #c9a961; font-size: 0.9em; margin-bottom: 6px; font-weight: 600;">Message *</label>
                <textarea 
                    id="contactMessage" 
                    placeholder="Your message here..." 
                    style="width: 100%; min-height: 140px; resize: vertical; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 6px; padding: 10px;"
                    oninput="updateContactCharacterCount()"
                ></textarea>
                
                <!-- Character counter -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 0.85em;">
                    <div id="contactValidationMessage" style="color: #ff6b6b; display: none;"></div>
                    <div id="contactCharacterCount" style="color: #aaa;">0 / 2000</div>
                </div>
            </div>
            
            <!-- Human Verification Section -->
            <div id="contactHumanVerification" style="margin-top: 15px; padding: 12px; background: rgba(107, 207, 127, 0.1); border: 1px solid rgba(107, 207, 127, 0.3); border-radius: 6px; display: none;">
                <div style="color: #6bcf7f; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    ü§ñ <span>Human Verification</span>
                </div>
                <div style="color: #ddd; font-size: 0.9em; margin-bottom: 10px;">
                    Please solve this simple math problem to verify you're human:
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="contactMathQuestion" style="color: #ffd700; font-size: 1.1em; font-weight: bold;"></span>
                    <input 
                        type="number" 
                        id="contactMathAnswer" 
                        placeholder="Answer"
                        style="width: 80px; padding: 6px; background: rgba(0,0,0,0.4); color: #ddd; border: 1px solid rgba(201,169,97,0.3); border-radius: 4px; text-align: center;"
                    >
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 14px;">
                <button class="close-modal-btn" onclick="document.getElementById('contactModal').classList.remove('active'); resetContactForm();">Cancel</button>
                <button 
                    id="contactSubmit"
                    class="close-modal-btn" 
                    onclick="sendContactMessage()"
                    style="background: linear-gradient(135deg, #6bcf7f, #2fbf71); border: none; color: #102015; cursor: pointer;">
                    Send Message
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game Over Overlay (will be created via JS) -->
    
<!-- CRITICAL: Error handler must load first (blocking) -->
<script src="src/js/core/error-handler.js?v=1.4.3"></script>

<!-- FIREBASE CONFIG (blocking - needed early) -->
<script src="src/config/firebase-config.js"></script>

<!-- DEFERRED SCRIPTS (non-blocking, maintain order) -->
<script src="src/js/features/inline-scripts.js?v=1.4.3" defer></script>
<script type="module" src="src/js/core/firebase-auth.js?v=1.4.3" defer></script>
<script src="src/js/utils/helpers.js?v=1.4.3" defer></script>
<script src="src/js/utils/mobile-optimization.js?v=1.4.3" defer></script>
<script src="src/js/utils/offline-storage.js?v=1.4.3" defer></script>
<script src="src/js/systems/achievements.js?v=1.4.3" defer></script>
<script src="src/js/data/game-data.js?v=1.4.3" defer></script>
<script src="src/js/systems/stats.js?v=1.4.3" defer></script>
<script src="src/js/systems/leaderboard.js?v=1.4.3" defer></script>
<script src="src/js/core/audio-context.js?v=1.4.3" defer></script>
<script src="src/js/systems/music.js?v=1.4.3" defer></script>

<!-- EMAILJS: async load CDN -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" async></script>
<script src="src/js/init-emailjs.js?v=1.4.3" defer></script>
<script src="src/js/firebase-ready.js?v=1.4.3" defer></script>

<!-- MAIN GAME (module, deferred) -->
<script type="module" src="src/js/game.js?v=1.4.3" defer></script>

<!-- CODEX (loads after game.js) -->
<script src="src/js/systems/codex.js?v=1.4.3" defer></script>

<!-- SERVICE WORKER REGISTRATION -->
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
    });
}
</script>

</body>
</html>
