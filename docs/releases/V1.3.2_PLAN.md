# üéØ v1.3.2 IMPLEMENTATION PLAN

**Date**: 2025-01-08  
**Author**: Gabriel Lima  
**Status**: üìã Ready to Implement  
**Priority**: HIGH (User Feedback)

---

## üêõ BUGS TO FIX

### 1. Merchant Button Not Responding
**User Report**: "O mercador bugou v√°rias vezes, eu clicava e n√£o acontecia nada"

**Fix Required**:
```javascript
// In openShop() function:
// Add console logging
console.log('[SHOP] Opening shop...');

// Add visual feedback
btnOpenShop.disabled = true;
btnOpenShop.textContent = '‚è≥ Loading...';

// Add error handling
try {
    // existing shop code
} catch (error) {
    console.error('[SHOP] Error:', error);
    showMessage('‚ùå Error opening shop', 'danger');
}

// Restore button
setTimeout(() => {
    btnOpenShop.textContent = 'üè∫ MERCHANT';
    btnOpenShop.disabled = false;
}, 300);
```

---

## ‚ö†Ô∏è UX IMPROVEMENTS

### 2. Add Danger Warnings to Risky Choices
**User Report**: "A primeira vez q eu morri foi pq eu assumi o risco e perdi e tomei insta kill"

**Events That Need Warnings**:

#### Cursed Treasure (line ~5721)
```javascript
// BEFORE:
{ text: 'üí∞ Take the risk (+50 gold, -10 HP)', effect: () => { 
    if (game.health > 10) { game.health -= 10; earnGold(50); }
    else { showMessage('‚ö†Ô∏è Too risky!', 'danger'); }
}}

// AFTER:
{ 
    text: game.health <= 10 
        ? '‚ö†Ô∏è DANGER: Take the risk (+50 gold, -10 HP) - COULD BE FATAL!' 
        : 'üí∞ Take the risk (+50 gold, -10 HP)',
    effect: () => { 
        if (game.health > 10) { game.health -= 10; earnGold(50); showMessage('üí∞ +50 gold! But the curse hurts...', 'success'); }
        else { showMessage('‚ö†Ô∏è Too risky! You need more than 10 HP!', 'danger'); }
        updateUI();
    }
}
```

#### Cursed Treasure - Cleanse Option (line ~5728)
```javascript
// AFTER:
{ 
    text: game.health <= 15 
        ? '‚ö†Ô∏è DANGER: Try to cleanse (50% chance) - COULD BE FATAL IF FAILS!' 
        : 'üîÆ Try to cleanse it (50% chance)',
    effect: () => {
        if (Math.random() < 0.5) { 
            earnGold(60); 
            showMessage('‚ú® Cleansed! +60 gold with no curse!', 'success'); 
        } else { 
            game.health -= 15; 
            showMessage('üíî The curse backfired! -15 HP!', 'danger'); 
        }
        updateUI();
    }
}
```

#### Shrine - Sacrifice HP (line ~5674)
```javascript
// AFTER:
{ 
    text: game.health <= 5 
        ? '‚ö†Ô∏è DANGER: Sacrifice 5 HP for +2 damage - COULD BE FATAL!' 
        : '‚ù§Ô∏è Sacrifice 5 HP for +2 weapon damage (Gain Berserker Ring)',
    effect: () => {
        if (game.health > 5) { 
            game.health -= 5; 
            game.relics.push({...RELICS.find(r => r.id === 'berserker_ring')}); 
            showMessage('Gained Berserker Ring!', 'success'); 
            updateRelicsDisplay(); 
        } else { 
            showMessage('‚ö†Ô∏è Not enough HP! You need more than 5 HP!', 'danger'); 
        }
        updateUI();
    }
}
```

---

### 3. Add Tooltips/Explanations to Event Choices

**Implementation**:
```javascript
// Add to showEventModal function:
event.choices.forEach(choice => {
    const choiceEl = document.createElement('div');
    choiceEl.className = 'event-choice';
    choiceEl.innerHTML = choice.text;
    
    // Add tooltip with detailed explanation
    if (choice.tooltip) {
        choiceEl.title = choice.tooltip;
        choiceEl.style.cursor = 'help';
    }
    
    // Add danger indicator
    if (choice.text.includes('‚ö†Ô∏è DANGER')) {
        choiceEl.style.borderColor = '#ff6b6b';
        choiceEl.style.borderWidth = '2px';
    }
    
    choiceEl.onclick = () => {
        choice.effect();
        // ... rest of code
    };
    
    eventChoices.appendChild(choiceEl);
});
```

---

### 4. Show Current HP Before Risky Decisions

**Implementation**:
```javascript
// In showEventModal function, add HP display:
if (event.hasRiskyChoices) {
    const hpWarning = document.createElement('div');
    hpWarning.style.cssText = 'background: rgba(255, 107, 107, 0.1); border: 2px solid #ff6b6b; padding: 10px; margin: 10px 0; border-radius: 8px; text-align: center;';
    hpWarning.innerHTML = `<strong>‚ö° Current HP: ${game.health} / ${game.maxHealth}</strong>`;
    eventText.appendChild(hpWarning);
}
```

---

## üìö NEW FEATURE

### 5. Relics Glossary/Guide

**Implementation**:
```javascript
// Add to index.html:
<button onclick="openRelicsGuide()" class="menu-btn">
    üìñ Relics Guide
</button>

<div class="modal-overlay" id="relicsGuideModal">
    <div class="modal-content">
        <h2>üìñ Relics Guide</h2>
        <div id="relicsGlossary"></div>
    </div>
</div>

// JavaScript function:
function openRelicsGuide() {
    const glossary = document.getElementById('relicsGlossary');
    glossary.innerHTML = RELICS.map(r => {
        const discovered = game.discoveredRelics.includes(r.id);
        return `
            <div class="relic-glossary-item ${discovered ? '' : 'undiscovered'}">
                <div class="relic-name">${r.name}</div>
                <div class="relic-description">${r.description}</div>
                <div class="relic-rarity">${r.rarity}</div>
                ${discovered ? '‚úÖ Discovered' : 'üîí Undiscovered'}
            </div>
        `;
    }).join('');
    
    document.getElementById('relicsGuideModal').classList.add('active');
}
```

---

## üß™ TESTING CHECKLIST

### Before Release
- [ ] Test merchant button 20+ times
- [ ] Verify all console logs appear
- [ ] Test each risky event with low HP
- [ ] Verify danger warnings appear
- [ ] Test relics guide modal
- [ ] Check visual feedback on buttons
- [ ] Mobile testing
- [ ] Cross-browser testing

### Specific Scenarios
- [ ] Click merchant with 1 HP
- [ ] Click merchant with full inventory
- [ ] Take cursed treasure with 11 HP
- [ ] Take cursed treasure with 10 HP
- [ ] Cleanse cursed treasure with 16 HP
- [ ] Cleanse cursed treasure with 15 HP
- [ ] Sacrifice at shrine with 6 HP
- [ ] Sacrifice at shrine with 5 HP

---

## üìù IMPLEMENTATION ORDER

### Phase 1: Critical Bug Fix (30 min)
1. Fix merchant button with error handling
2. Add console logging
3. Add visual feedback
4. Test extensively

### Phase 2: Danger Warnings (45 min)
1. Add HP checks to risky choices
2. Add ‚ö†Ô∏è DANGER prefix
3. Show current HP in events
4. Test with low HP scenarios

### Phase 3: Tooltips & UX (30 min)
1. Add tooltips to choices
2. Add hover effects
3. Improve visual indicators
4. Test user flow

### Phase 4: Relics Guide (1 hour)
1. Create modal HTML
2. Implement JavaScript
3. Style properly
4. Add discovery tracking

**Total Time**: ~3 hours

---

## üöÄ RELEASE PLAN

### After Implementation
1. Test locally (all scenarios)
2. Commit with detailed message
3. Update to v1.3.2
4. Update CHANGELOG
5. Create git tag
6. Push to GitHub
7. Netlify auto-deploy
8. Verify in production
9. Notify friend for re-testing

---

## üìä SUCCESS METRICS

### Before v1.3.2
- Merchant button: Sometimes unresponsive
- Risky choices: No warnings
- HP display: Not shown
- Relics guide: Non-existent

### After v1.3.2
- Merchant button: 100% responsive with feedback
- Risky choices: Clear warnings when dangerous
- HP display: Shown before risky decisions
- Relics guide: Complete glossary available

---

**Status**: üìã **PLAN COMPLETE**  
**Next**: Implement fixes carefully  
**Goal**: Better UX and zero bugs

